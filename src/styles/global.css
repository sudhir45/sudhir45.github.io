@import "tailwindcss";

@plugin "@tailwindcss/typography";

@custom-variant dark (&:where(.dark, .dark *));

/* Performance: Reduce layout shifts */
@layer base {
    img {
        @apply h-auto max-w-full;
        content-visibility: auto;
    }
    
    /* Smooth scrolling with respect for user preferences */
    @media (prefers-reduced-motion: no-preference) {
        html {
            scroll-behavior: smooth;
        }
    }
}

/* Professional Typography & Spacing */
@layer base {
    :root {
        --font-ui: 'Manrope', 'Segoe UI', 'Helvetica Neue', sans-serif;
        --font-code: 'IBM Plex Mono', 'Consolas', 'Monaco', monospace;
    }

    html {
        @apply antialiased;
        font-feature-settings: "kern" 1, "liga" 1, "cv11" 1;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    body {
        font-family: var(--font-ui);
        letter-spacing: -0.012em;
    }

    h1, h2, h3, h4 {
        letter-spacing: -0.02em;
    }

    code,
    pre,
    kbd {
        font-family: var(--font-code);
    }

    /* Fluid type scale for headings */
    h1 { font-size: clamp(1.875rem, 1.5rem + 1.5vw, 3rem); }
    h2 { font-size: clamp(1.5rem, 1.25rem + 1vw, 2.25rem); }
    h3 { font-size: clamp(1.25rem, 1.1rem + 0.6vw, 1.75rem); }

    /* Focus styles for accessibility */
    a:focus-visible,
    button:focus-visible {
        @apply outline-none ring-2 ring-orange-500/50 ring-offset-2 ring-offset-stone-100 dark:ring-offset-stone-900;
    }
}

/* Refined Code Highlighting */
@layer utilities {
    .content pre {
        @apply p-0;
    }

    .content code {
        @apply overflow-x-auto;
    }

    .content [data-rehype-pretty-code-figure] code {
        @apply p-0;
    }

    .content pre > code span[data-line] {
        @apply border-l-4 border-transparent px-4;
    }

    .content pre > code span:first-of-type {
        @apply rounded-t-lg pt-4;
    }

    .content pre > code span:last-of-type {
        @apply rounded-b-lg pb-4;
    }

    .content pre > code .highlighted {
        @apply border-l-4 border-orange-500/30 bg-orange-500/5 dark:bg-orange-500/10;
    }

    .content pre > code[data-line-numbers] {
        counter-reset: line;
    }

    .content pre > code[data-line-numbers] > span[data-line]::before {
        counter-increment: line;
        content: counter(line);
        @apply mr-6 inline-block w-6 text-left text-stone-400 dark:text-stone-600;
        font-variant-numeric: tabular-nums;
    }

    .content pre > code > span[data-line]::before {
        content: '';
        @apply inline-block w-0;
    }

    .content pre > code[data-line-numbers-max-digits='2'] > span[data-line]::before {
        @apply w-8;
    }

    .content code[data-line-numbers-max-digits='3'] > span[data-line]::before {
        @apply w-10;
    }
}

/* Professional Scrollbar */
@layer utilities {
    ::-webkit-scrollbar {
        @apply w-2 h-2;
    }

    ::-webkit-scrollbar-track {
        @apply bg-transparent;
    }

    ::-webkit-scrollbar-thumb {
        @apply bg-stone-300 dark:bg-stone-700 rounded-full;
    }

    ::-webkit-scrollbar-thumb:hover {
        @apply bg-stone-400 dark:bg-stone-600;
    }
}
