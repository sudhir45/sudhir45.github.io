---
import Section from './Section.astro';
import Search from './Search.astro';
---

<Section>
	<div class="flex items-center justify-between border-b border-stone-200/60 pb-4 dark:border-stone-800/60">
		<div class="text-2xl font-semibold tracking-tight">
			<a href="/" class="group flex items-baseline gap-1 transition-colors hover:text-orange-600 dark:hover:text-orange-500">
				<span class="text-orange-600 dark:text-orange-500">Fort</span>
				<span class="text-stone-600 dark:text-stone-400">Matrix</span>
				<span class="text-stone-400 dark:text-stone-600 text-lg font-normal">Logs</span>
			</a>
		</div>
		<div class="flex items-center gap-6">
			<!-- Desktop Navigation -->
			<nav>
				<ul class="hidden flex-row items-center gap-6 text-sm font-medium sm:flex">
					<li><a href="/about" class="text-stone-600 transition-colors hover:text-orange-600 dark:text-stone-400 dark:hover:text-orange-500">About</a></li>
					<li><a href="/tags" class="text-stone-600 transition-colors hover:text-orange-600 dark:text-stone-400 dark:hover:text-orange-500">Tags</a></li>
					<li><a href="/posts" class="text-stone-600 transition-colors hover:text-orange-600 dark:text-stone-400 dark:hover:text-orange-500">Blog</a></li>
					<li><a href="/presentations" class="text-stone-600 transition-colors hover:text-orange-600 dark:text-stone-400 dark:hover:text-orange-500">Presentations</a></li>
				</ul>
			</nav>
			<!-- Desktop Theme Switcher -->
			<div class="hidden flex-col justify-center sm:flex">
				<input type="checkbox" id="light-switch-desktop" class="light-switch sr-only" />
				<label class="relative cursor-pointer rounded-lg p-2 transition-colors hover:bg-stone-100 dark:hover:bg-stone-900" for="light-switch-desktop">
					<svg class="dark:hidden" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
						<path
							class="fill-stone-800"
							d="M7 0h2v2H7zM12.88 1.637l1.414 1.415-1.415 1.413-1.413-1.414zM14 7h2v2h-2zM12.95 14.433l-1.414-1.413 1.413-1.415 1.415 1.414zM7 14h2v2H7zM2.98 14.364l-1.413-1.415 1.414-1.414 1.414 1.415zM0 7h2v2H0zM3.05 1.706 4.463 3.12 3.05 4.535 1.636 3.12z"
						></path>
						<path class="fill-gray-900" d="M8 4C5.8 4 4 5.8 4 8s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4Z"
						></path>
					</svg>
					<svg class="hidden dark:block" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
						<path
							class="fill-slate-400"
							d="M6.2 1C3.2 1.8 1 4.6 1 7.9 1 11.8 4.2 15 8.1 15c3.3 0 6-2.2 6.9-5.2C9.7 11.2 4.8 6.3 6.2 1Z"
						></path>
						<path
							class="fill-slate-500"
							d="M12.5 5a.625.625 0 0 1-.625-.625 1.252 1.252 0 0 0-1.25-1.25.625.625 0 1 1 0-1.25 1.252 1.252 0 0 0 1.25-1.25.625.625 0 1 1 1.25 0c.001.69.56 1.249 1.25 1.25a.625.625 0 1 1 0 1.25c-.69.001-1.249.56-1.25 1.25A.625.625 0 0 1 12.5 5Z"
						></path>
					</svg>
					<span class="sr-only">Switch to light / dark version</span>
				</label>
			</div>
			
			<!-- Search Button -->
			<div class="block">
				<Search />
			</div>

			<!-- Mobile Menu Button -->
			<button 
				id="mobile-menu-button" 
				class="rounded-lg p-2 transition-colors hover:bg-stone-100 dark:hover:bg-stone-900 sm:hidden" 
				aria-label="Toggle mobile menu"
				aria-expanded="false"
				aria-controls="mobile-menu"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					class="h-6 w-6"
					fill="none"
					viewBox="0 0 24 24"
					stroke="currentColor"
					stroke-width="2"
				>
					<path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
				</svg>
			</button>
		</div>
	</div>

	<!-- Mobile Menu -->
	<div
		id="mobile-menu"
		class="mt-4 hidden rounded-xl border border-stone-200 bg-white pb-3 shadow-lg transition-all duration-200 sm:hidden dark:border-stone-800 dark:bg-stone-900"
	>
		<nav class="flex flex-col p-2">
			<a href="/about" class="rounded-lg px-4 py-2.5 text-sm font-medium text-stone-700 transition-colors hover:bg-stone-100 hover:text-orange-600 dark:text-stone-300 dark:hover:bg-stone-800 dark:hover:text-orange-500">About</a>
			<a href="/tags" class="rounded-lg px-4 py-2.5 text-sm font-medium text-stone-700 transition-colors hover:bg-stone-100 hover:text-orange-600 dark:text-stone-300 dark:hover:bg-stone-800 dark:hover:text-orange-500">Tags</a>
			<a href="/posts" class="rounded-lg px-4 py-2.5 text-sm font-medium text-stone-700 transition-colors hover:bg-stone-100 hover:text-orange-600 dark:text-stone-300 dark:hover:bg-stone-800 dark:hover:text-orange-500">Blog</a>
			<a href="/presentations" class="rounded-lg px-4 py-2.5 text-sm font-medium text-stone-700 transition-colors hover:bg-stone-100 hover:text-orange-600 dark:text-stone-300 dark:hover:bg-stone-800 dark:hover:text-orange-500">Presentations</a>
			<!-- Mobile Theme Switcher -->
			<div class="flex items-center border-t border-stone-200 px-2 py-2 dark:border-stone-800">
				<input type="checkbox" id="light-switch-mobile" class="light-switch sr-only" />
				<label class="relative flex w-full cursor-pointer items-center justify-between rounded-lg px-4 py-2.5 transition-colors hover:bg-stone-100 dark:hover:bg-stone-800" for="light-switch-mobile">
					<span class="text-sm font-medium text-stone-700 dark:text-stone-300">Theme</span>
					<svg class="dark:hidden" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
						<path
							class="fill-stone-800"
							d="M7 0h2v2H7zM12.88 1.637l1.414 1.415-1.415 1.413-1.413-1.414zM14 7h2v2h-2zM12.95 14.433l-1.414-1.413 1.413-1.415 1.415 1.414zM7 14h2v2H7zM2.98 14.364l-1.413-1.415 1.414-1.414 1.414 1.415zM0 7h2v2H0zM3.05 1.706 4.463 3.12 3.05 4.535 1.636 3.12z"
						></path>
						<path class="fill-gray-900" d="M8 4C5.8 4 4 5.8 4 8s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4Z"
						></path>
					</svg>
					<svg class="hidden dark:block" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
						<path
							class="fill-slate-400"
							d="M6.2 1C3.2 1.8 1 4.6 1 7.9 1 11.8 4.2 15 8.1 15c3.3 0 6-2.2 6.9-5.2C9.7 11.2 4.8 6.3 6.2 1Z"
						></path>
						<path
							class="fill-slate-500"
							d="M12.5 5a.625.625 0 0 1-.625-.625 1.252 1.252 0 0 0-1.25-1.25.625.625 0 1 1 0-1.25 1.252 1.252 0 0 0 1.25-1.25.625.625 0 1 1 1.25 0c.001.69.56 1.249 1.25 1.25a.625.625 0 1 1 0 1.25c-.69.001-1.249.56-1.25 1.25A.625.625 0 0 1 12.5 5Z"
						></path>
					</svg>
					<span class="sr-only">Switch to light / dark version</span>
				</label>
			</div>
		</nav>
	</div>
</Section>

<script>
	document.addEventListener('astro:page-load', () => {
		// Theme switching functionality
		const lightSwitches = document.querySelectorAll('.light-switch');

		function applyTheme(isDark: boolean) {
			if (isDark) {
				document.documentElement.classList.add('dark');
				localStorage.setItem('theme', 'dark');
			} else {
				document.documentElement.classList.remove('dark');
				localStorage.setItem('theme', 'light');
			}
		}

		if (lightSwitches.length > 0) {
			// Initialize theme based on localStorage (default to dark if no preference)
			const storedTheme = localStorage.getItem('theme');
			const isDarkTheme = storedTheme === null ? true : storedTheme === 'dark';
			applyTheme(isDarkTheme);

			// Set initial state of switches
			lightSwitches.forEach((lightSwitch) => {
				(lightSwitch as HTMLInputElement).checked = isDarkTheme;
			});

			// Add click event listeners
			lightSwitches.forEach((lightSwitch) => {
				(lightSwitch as HTMLInputElement).addEventListener('click', () => {
					const isChecked = (lightSwitch as HTMLInputElement).checked;
					// Apply theme
					applyTheme(isChecked);
				});
			});
		}

		// Mobile menu toggle functionality
		const mobileMenuButton = document.getElementById('mobile-menu-button');
		const mobileMenu = document.getElementById('mobile-menu');

		if (mobileMenuButton && mobileMenu) {
			// Reset mobile menu state on navigation
			mobileMenu.classList.add('hidden');
			mobileMenuButton.setAttribute('aria-expanded', 'false');
			mobileMenuButton.innerHTML = `
				<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
					<path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
				</svg>
			`;

			mobileMenuButton.addEventListener('click', () => {
				const expanded = mobileMenuButton.getAttribute('aria-expanded') === 'true' || false;
				const newExpanded = !expanded;
				mobileMenuButton.setAttribute('aria-expanded', newExpanded.toString());
				mobileMenu.classList.toggle('hidden');

				// Change burger icon to X when menu is open
				if (!expanded) {
					mobileMenuButton.innerHTML = `
						<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
							<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
						</svg>
					`;
				} else {
					mobileMenuButton.innerHTML = `
						<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
							<path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
						</svg>
					`;
				}
			});
		}
	});
</script>
