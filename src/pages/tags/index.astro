---
import Heading from '@/components/Heading.astro';
import Section from '@/components/Section.astro';
import Base from '@/layouts/Base.astro';
import { AppConfig } from '@/utils/AppConfig';
import { MarkdownInstance } from 'astro';

const { title } = AppConfig;
const { description } = AppConfig;

const allPosts = Object.values(
	import.meta.glob('../posts/*.md', { eager: true })
) as MarkdownInstance<any>[];
const allTags = allPosts.map((post) => post.frontmatter.tags).flat();
const uniqueTags: Set<string> = new Set(allTags);
let tagMap: Record<string, number> = {};

[...uniqueTags].forEach((tag) => {
	const count = allTags.filter((t) => t === tag).length;
	tagMap[tag] = count;
});

tagMap = Object.fromEntries(Object.entries(tagMap).sort((a, b) => b[1] - a[1]));
---

<Base head={{ title, description }}>
	<Section>
		<div class="mb-8">
			<Heading title="All Tags" />
			<p class="mt-4 text-center text-sm text-stone-600 dark:text-stone-400">
				Browse posts by topic
			</p>
		</div>
		<div class="flex flex-wrap items-center justify-center gap-3">
			{
				Object.entries(tagMap).map(([tag, count]) => (
					<a
						href={`/tags/${tag}`}
						class="group relative flex items-center gap-2 rounded-lg border border-stone-200 bg-white px-4 py-2.5 text-sm font-medium text-stone-700 transition-all hover:border-orange-300 hover:bg-orange-50 hover:text-orange-600 hover:shadow-sm dark:border-stone-800 dark:bg-stone-900 dark:text-stone-300 dark:hover:border-orange-900/50 dark:hover:bg-orange-950/30 dark:hover:text-orange-500"
					>
						<span>{tag}</span>
						<span class="rounded-full bg-stone-100 px-2 py-0.5 text-xs font-semibold text-stone-600 transition-colors group-hover:bg-orange-100 group-hover:text-orange-700 dark:bg-stone-800 dark:text-stone-400 dark:group-hover:bg-orange-950/50 dark:group-hover:text-orange-400">
							{count}
						</span>
					</a>
				))
			}
		</div>
	</Section>
</Base>
